{
	"name": "SCD PRODUTO",
	"properties": {
		"folder": {
			"name": "DATA CLEANSING"
		},
		"content": {
			"query": "TRUNCATE TABLE  temp.cigam_produtos_processamento\nTRUNCATE TABLE  temp.cigam_produtos_final\n\ninsert into temp.cigam_produtos_processamento\nselect \nconvert(varchar(25),PRODUTO_REFERENCIATAM) as pk_produto\n,PRODUTO_MODELO \n,PRODUTO_REFERENCIA \n,PRODUTO_DESCRICAO \n,PRODUTO_COLECAO \n,PRODUTO_SUBCOLECAO \n,PRODUTO_LINHA \n,PRODUTO_ARTIGO \n,PRODUTO_COMPL_ARTIGO \n,PRODUTO_COR \n,PRODUTO_COR_FRANQUEADORA \n,PRODUTO_GENERO \n,PRODUTO_MARCA \n,PRODUTO_GRUPOALVO \n,PRODUTO_MATERIAL \n,PRODUTO_REFERENCIATAM \n,PRODUTO_EAN \n,PRODUTO_TAMANHO \n,PRODUTO_UNIDADEMED \n,PRODUTO_ATIVO \n,'SEM ALTERACAO' AS TIPO_ACAO\n,FLAG_VIGENCIA \n,DAT_INICIO_VIGENCIA \n,DAT_FINAL_VIGENCIA\nfrom cleansing_data.cigam_gst_bi_produtos\n\n\n\n\ninsert into temp.cigam_produtos_final\nselect \nconvert(varchar(25),PRODUTO_REFERENCIATAM) as pk_produto\n,PRODUTO_MODELO \n,PRODUTO_REFERENCIA \n,PRODUTO_DESCRICAO \n,PRODUTO_COLECAO \n,PRODUTO_SUBCOLECAO \n,PRODUTO_LINHA \n,PRODUTO_ARTIGO \n,PRODUTO_COMPL_ARTIGO \n,PRODUTO_COR \n,PRODUTO_COR_FRANQUEADORA \n,PRODUTO_GENERO \n,PRODUTO_MARCA \n,PRODUTO_GRUPOALVO \n,PRODUTO_MATERIAL \n,PRODUTO_REFERENCIATAM \n,PRODUTO_EAN \n,PRODUTO_TAMANHO \n,PRODUTO_UNIDADEMED \n,PRODUTO_ATIVO \n,FLAG_VIGENCIA \n,DAT_INICIO_VIGENCIA \n,DAT_FINAL_VIGENCIA\nfrom cleansing_data.cigam_gst_bi_produtos\n\nMERGE  temp.cigam_produtos_processamento AS produto \nUSING(\n\t    select \n\t\tconvert(varchar(25),PRODUTO_REFERENCIATAM) as pk_produto\n\t\t,PRODUTO_MODELO \n\t\t,PRODUTO_REFERENCIA \n\t\t,PRODUTO_DESCRICAO \n\t\t,PRODUTO_COLECAO \n\t\t,PRODUTO_SUBCOLECAO \n\t\t,PRODUTO_LINHA \n\t\t,PRODUTO_ARTIGO \n\t\t,PRODUTO_COMPL_ARTIGO \n\t\t,PRODUTO_COR \n\t\t,PRODUTO_COR_FRANQUEADORA \n\t\t,PRODUTO_GENERO \n\t\t,PRODUTO_MARCA \n\t\t,PRODUTO_GRUPOALVO \n\t\t,PRODUTO_MATERIAL \n\t\t,PRODUTO_REFERENCIATAM \n\t\t,PRODUTO_EAN \n\t\t,PRODUTO_TAMANHO \n\t\t,PRODUTO_UNIDADEMED \n\t\t,PRODUTO_ATIVO \n        ,1 as FLAG_VIGENCIA \n        ,getdate() as DAT_INICIO_VIGENCIA\n        ,null DAT_FINAL_VIGENCIA \n\t\tfrom\n\t\t[raw_data].[cigam_gst_bi_produtos]\n\t\tWHERE DAT_HORA_EXPORTACAO = '2021-03-02 14:09:16.963'\n) AS DL ON (DL.pk_produto = produto.pk_produto)\n\tWHEN NOT MATCHED BY TARGET THEN INSERT (\n                                                 pk_produto\n\t\t\t\t\t\t\t\t\t\t\t\t,PRODUTO_MODELO \n\t\t\t\t\t\t\t\t\t\t\t\t,PRODUTO_REFERENCIA \n\t\t\t\t\t\t\t\t\t\t\t\t,PRODUTO_DESCRICAO \n\t\t\t\t\t\t\t\t\t\t\t\t,PRODUTO_COLECAO \n\t\t\t\t\t\t\t\t\t\t\t\t,PRODUTO_SUBCOLECAO \n\t\t\t\t\t\t\t\t\t\t\t\t,PRODUTO_LINHA \n\t\t\t\t\t\t\t\t\t\t\t\t,PRODUTO_ARTIGO \n\t\t\t\t\t\t\t\t\t\t\t\t,PRODUTO_COMPL_ARTIGO \n\t\t\t\t\t\t\t\t\t\t\t\t,PRODUTO_COR \n\t\t\t\t\t\t\t\t\t\t\t\t,PRODUTO_COR_FRANQUEADORA \n\t\t\t\t\t\t\t\t\t\t\t\t,PRODUTO_GENERO \n\t\t\t\t\t\t\t\t\t\t\t\t,PRODUTO_MARCA \n\t\t\t\t\t\t\t\t\t\t\t\t,PRODUTO_GRUPOALVO \n\t\t\t\t\t\t\t\t\t\t\t\t,PRODUTO_MATERIAL \n\t\t\t\t\t\t\t\t\t\t\t\t,PRODUTO_REFERENCIATAM \n\t\t\t\t\t\t\t\t\t\t\t\t,PRODUTO_EAN \n\t\t\t\t\t\t\t\t\t\t\t\t,PRODUTO_TAMANHO \n\t\t\t\t\t\t\t\t\t\t\t\t,PRODUTO_UNIDADEMED \n\t\t\t\t\t\t\t\t\t\t\t\t,PRODUTO_ATIVO \n\t\t\t\t\t\t\t\t\t\t\t\t,FLAG_VIGENCIA \n\t\t\t\t\t\t\t\t\t\t\t\t,DAT_INICIO_VIGENCIA\n\t\t\t\t\t\t\t\t\t\t\t\t,DAT_FINAL_VIGENCIA \n                                               )\n\t\t\t\t\t\t\t\t\tVALUES ( DL.pk_produto\n\t\t\t\t\t\t\t\t\t\t\t,DL.PRODUTO_MODELO \n\t\t\t\t\t\t\t\t\t\t\t,DL.PRODUTO_REFERENCIA \n\t\t\t\t\t\t\t\t\t\t\t,DL.PRODUTO_DESCRICAO \n\t\t\t\t\t\t\t\t\t\t\t,DL.PRODUTO_COLECAO \n\t\t\t\t\t\t\t\t\t\t\t,DL.PRODUTO_SUBCOLECAO \n\t\t\t\t\t\t\t\t\t\t\t,DL.PRODUTO_LINHA \n\t\t\t\t\t\t\t\t\t\t\t,DL.PRODUTO_ARTIGO \n\t\t\t\t\t\t\t\t\t\t\t,DL.PRODUTO_COMPL_ARTIGO \n\t\t\t\t\t\t\t\t\t\t\t,DL.PRODUTO_COR \n\t\t\t\t\t\t\t\t\t\t\t,DL.PRODUTO_COR_FRANQUEADORA \n\t\t\t\t\t\t\t\t\t\t\t,DL.PRODUTO_GENERO \n\t\t\t\t\t\t\t\t\t\t\t,DL.PRODUTO_MARCA \n\t\t\t\t\t\t\t\t\t\t\t,DL.PRODUTO_GRUPOALVO \n\t\t\t\t\t\t\t\t\t\t\t,DL.PRODUTO_MATERIAL \n\t\t\t\t\t\t\t\t\t\t\t,DL.PRODUTO_REFERENCIATAM \n\t\t\t\t\t\t\t\t\t\t\t,DL.PRODUTO_EAN \n\t\t\t\t\t\t\t\t\t\t\t,DL.PRODUTO_TAMANHO \n\t\t\t\t\t\t\t\t\t\t\t,DL.PRODUTO_UNIDADEMED \n\t\t\t\t\t\t\t\t\t\t\t,DL.PRODUTO_ATIVO \n                                            ,'INSERT'\n                                            ,DL.FLAG_VIGENCIA\n                                            ,DL.DAT_INICIO_VIGENCIA\n                                            ,DL.DAT_FINAL_VIGENCIA)\n\t\tWHEN MATCHED AND (  produto.PRODUTO_MODELO != PRODUTO_MODELO or\n\t\t\t\t\t\t\tproduto.PRODUTO_REFERENCIA  != PRODUTO_REFERENCIA or\n\t\t\t\t\t\t\tproduto.PRODUTO_DESCRICAO  != PRODUTO_DESCRICAO or\n\t\t\t\t\t\t\tproduto.PRODUTO_COLECAO  != PRODUTO_COLECAO or\n\t\t\t\t\t\t\tproduto.PRODUTO_SUBCOLECAO  != PRODUTO_SUBCOLECAO or\n\t\t\t\t\t\t\tproduto.PRODUTO_LINHA  != PRODUTO_LINHA or\n\t\t\t\t\t\t\tproduto.PRODUTO_ARTIGO  != PRODUTO_ARTIGO or\n\t\t\t\t\t\t\tproduto.PRODUTO_COMPL_ARTIGO  != PRODUTO_COMPL_ARTIGO or\n\t\t\t\t\t\t\tproduto.PRODUTO_COR  != PRODUTO_COR or\n\t\t\t\t\t\t\tproduto.PRODUTO_COR_FRANQUEADORA  != PRODUTO_COR_FRANQUEADORA or\n\t\t\t\t\t\t\tproduto.PRODUTO_GENERO  != PRODUTO_GENERO or\n\t\t\t\t\t\t\tproduto.PRODUTO_MARCA  != PRODUTO_MARCA or\n\t\t\t\t\t\t\tproduto.PRODUTO_GRUPOALVO  != PRODUTO_GRUPOALVO or\n\t\t\t\t\t\t\tproduto.PRODUTO_MATERIAL  != PRODUTO_MATERIAL or\n\t\t\t\t\t\t\tproduto.PRODUTO_EAN  != PRODUTO_EAN or\n\t\t\t\t\t\t\tproduto.PRODUTO_TAMANHO  != PRODUTO_TAMANHO or\n\t\t\t\t\t\t\tproduto.PRODUTO_UNIDADEMED  != PRODUTO_UNIDADEMED or\n\t\t\t\t\t\t\tproduto.PRODUTO_ATIVO  != PRODUTO_ATIVO )\n    THEN UPDATE SET \n\t\t\t\t\t\tproduto.PRODUTO_MODELO != PRODUTO_MODELO or\n\t\t\t\t\t\tproduto.PRODUTO_REFERENCIA  != PRODUTO_REFERENCIA or\n\t\t\t\t\t\tproduto.PRODUTO_DESCRICAO  != PRODUTO_DESCRICAO or\n\t\t\t\t\t\tproduto.PRODUTO_COLECAO  != PRODUTO_COLECAO or\n\t\t\t\t\t\tproduto.PRODUTO_SUBCOLECAO  != PRODUTO_SUBCOLECAO or\n\t\t\t\t\t\tproduto.PRODUTO_LINHA  != PRODUTO_LINHA or\n\t\t\t\t\t\tproduto.PRODUTO_ARTIGO  != PRODUTO_ARTIGO or\n\t\t\t\t\t\tproduto.PRODUTO_COMPL_ARTIGO  != PRODUTO_COMPL_ARTIGO or\n\t\t\t\t\t\tproduto.PRODUTO_COR  != PRODUTO_COR or\n\t\t\t\t\t\tproduto.PRODUTO_COR_FRANQUEADORA  != PRODUTO_COR_FRANQUEADORA or\n\t\t\t\t\t\tproduto.PRODUTO_GENERO  != PRODUTO_GENERO or\n\t\t\t\t\t\tproduto.PRODUTO_MARCA  != PRODUTO_MARCA or\n\t\t\t\t\t\tproduto.PRODUTO_GRUPOALVO  != PRODUTO_GRUPOALVO or\n\t\t\t\t\t\tproduto.PRODUTO_MATERIAL  != PRODUTO_MATERIAL or\n\t\t\t\t\t\tproduto.PRODUTO_EAN  != PRODUTO_EAN or\n\t\t\t\t\t\tproduto.PRODUTO_TAMANHO  != PRODUTO_TAMANHO or\n\t\t\t\t\t\tproduto.PRODUTO_UNIDADEMED  != PRODUTO_UNIDADEMED or\n\t\t\t\t\t\tproduto.PRODUTO_ATIVO  != PRODUTO_ATIVO\n\t\t\t\t\t\t,produto.TIPO_ACAO = 'UPDATE'\n\t\t\t\t\t\t,produto.FLAG_VIGENCIA  =1\n\t\t\t\t\t\t,produto.DAT_INICIO_VIGENCIA  =GETDATE()\n\t\t\t\t\t\t,produto.DAT_FINAL_VIGENCIA  = NULL;\n\n\n\n\n\ninsert into  temp.cigam_produtos_final  \nselect \n pk_produto\n,PRODUTO_MODELO \n,PRODUTO_REFERENCIA \n,PRODUTO_DESCRICAO \n,PRODUTO_COLECAO \n,PRODUTO_SUBCOLECAO \n,PRODUTO_LINHA \n,PRODUTO_ARTIGO \n,PRODUTO_COMPL_ARTIGO \n,PRODUTO_COR \n,PRODUTO_COR_FRANQUEADORA \n,PRODUTO_GENERO \n,PRODUTO_MARCA \n,PRODUTO_GRUPOALVO \n,PRODUTO_MATERIAL \n,PRODUTO_REFERENCIATAM \n,PRODUTO_EAN \n,PRODUTO_TAMANHO \n,PRODUTO_UNIDADEMED \n,PRODUTO_ATIVO \n,FLAG_VIGENCIA \n,DAT_INICIO_VIGENCIA\n,DAT_FINAL_VIGENCIA   from temp.cigam_produtos_processamento where \n tipo_acao = 'insert'\n\nupdate temp.cigam_produtos_final   \nset \nflag_vigencia = 0, \ndat_final_vigencia = getdate()\nwhere pk_produto in (select  pk_produto  from temp.cigam_produtos_processamento where  tipo_acao = 'update')\nand flag_vigencia = 1\n\ninsert into  temp.cigam_produtos_final  \nselect \n pk_produto\n,PRODUTO_MODELO \n,PRODUTO_REFERENCIA \n,PRODUTO_DESCRICAO \n,PRODUTO_COLECAO \n,PRODUTO_SUBCOLECAO \n,PRODUTO_LINHA \n,PRODUTO_ARTIGO \n,PRODUTO_COMPL_ARTIGO \n,PRODUTO_COR \n,PRODUTO_COR_FRANQUEADORA \n,PRODUTO_GENERO \n,PRODUTO_MARCA \n,PRODUTO_GRUPOALVO \n,PRODUTO_MATERIAL \n,PRODUTO_REFERENCIATAM \n,PRODUTO_EAN \n,PRODUTO_TAMANHO \n,PRODUTO_UNIDADEMED \n,PRODUTO_ATIVO \n,FLAG_VIGENCIA \n,DAT_INICIO_VIGENCIA\n,DAT_FINAL_VIGENCIA  from temp.cigam_produtos_processamento where \n tipo_acao = 'UPDATE'\n\n\n\n        \n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"poolName": "Built-in",
				"databaseName": "master"
			}
		},
		"type": "SqlQuery"
	}
}