{
	"name": "Demo Cliente",
	"properties": {
		"content": {
			"query": "SET ANSI_NULLS ON\nSET QUOTED_IDENTIFIER ON\nGO\n\n\nDECLARE @SEPARATOR VARCHAR(30) = '     //     '\nDECLARE @COUNT_BEFORE BIGINT\nSELECT @COUNT_BEFORE = COUNT(*) FROM dw.cliente\nPRINT @SEPARATOR + 'INÍCIO: ' + CAST(@COUNT_BEFORE AS VARCHAR(30)) + ' CLIENTES'\n\n\nPRINT 'Create tmp_cliente'\nCREATE TABLE [dw].[tmp_cliente]\n( \n\t[pk_cliente] [bigint]  NULL,\n\t[Cidade] [nvarchar](3000)  NULL,\n\t[Cidade IBGE] [nvarchar](3000)  NULL,\n\t[Cidade/UF] [nvarchar](3000)  NULL,\n\t[Código] [bigint]  NULL,\n\t[Nome-Código] [nvarchar](3000)  NULL,\n\t[CEP] [nvarchar](3000)  NULL,\n\t[UF] [nvarchar](3000)  NULL,\n\t[Data de Criação] [nvarchar](3000)  NULL,\n\t[Dias Criação] [bigint]  NULL,\n\t[Ano Criação] [bigint]  NULL,\n\t[Cidade SAP] [nvarchar](3000)  NULL,\n\t[Região] [nvarchar](3000)  NULL,\n\t[Grupo Loja] [nvarchar](3000)  NULL,\n\t[Rede] [nvarchar](3000)  NULL\n)\nWITH\n(\n\tDISTRIBUTION = ROUND_ROBIN,\n\tCLUSTERED COLUMNSTORE INDEX\n)\n\n\nPRINT @SEPARATOR + 'Copy csv to tmp_cliente'\nCOPY INTO dw.tmp_cliente\n\t(pk_cliente 1, Cidade 2, [Cidade IBGE] 3, [Cidade/UF] 4, Código 5, [Nome-Código] 6, CEP 7, UF 8, [Data de Criação] 9, [Dias Criação] 10, [Ano Criação] 11, [Cidade SAP] 12, Região 13, [Grupo Loja] 14, Rede 15)\nFROM 'https://sadevbrdatalakemalwee.dfs.core.windows.net/raw/brazil/demo/Cliente.csv'\nWITH\n(\n\tFILE_TYPE = 'CSV'\n\t,MAXERRORS = 0\n\t,FIRSTROW = 2\n\t,ERRORFILE = 'https://sadevbrdatalakemalwee.dfs.core.windows.net/raw/brazil/demo/'\n\t,IDENTITY_INSERT = 'OFF'\n)\n\n\nPRINT @SEPARATOR + 'Drop cliente'\nDROP TABLE [dw].[cliente]\n\n\nPRINT @SEPARATOR + 'Create cliente'\nCREATE TABLE [dw].[cliente]\n( \n\t[pk_cliente] [bigint]  NOT NULL,\n\t[Cliente - Cidade] [nvarchar](3000)  NULL,\n\t[Cliente - Cidade IBGE] [nvarchar](3000)  NULL,\n\t[Cliente - Cidade/UF] [nvarchar](3000)  NULL,\n\t[Cliente - Código] [bigint]  NOT NULL,\n\t[Cliente - Nome-Código] [nvarchar](3000)  NULL,\n\t[Cliente - CEP] [nvarchar](3000)  NULL,\n\t[Cliente - UF] [nvarchar](3000)  NULL,\n\t[Cliente - Data de Criação] [date]  NULL,\n\t[Cliente - Dias Criação] [bigint]  NULL,\n\t[Cliente - Ano Criação] [bigint]  NULL,\n\t[Cliente - Cidade SAP] [nvarchar](3000)  NULL,\n\t[Cliente - Região] [nvarchar](3000)  NULL,\n\t[Cliente - Grupo Loja] [nvarchar](3000)  NULL,\n\t[Cliente - Rede] [nvarchar](3000)  NULL\n)\nWITH\n(\n\tDISTRIBUTION = ROUND_ROBIN,\n\tCLUSTERED COLUMNSTORE INDEX\n)\n\n\nPRINT @SEPARATOR + 'Load tmp to cliente'\ninsert into dw.cliente\n\t([pk_cliente], [Cliente - Cidade], [Cliente - Cidade IBGE], [Cliente - Cidade/UF], [Cliente - Código], [Cliente - Nome-Código], [Cliente - CEP], [Cliente - UF],\n\t[Cliente - Data de Criação],\n\t[Cliente - Dias Criação], [Cliente - Ano Criação], [Cliente - Cidade SAP], [Cliente - Região], [Cliente - Grupo Loja], [Cliente - Rede])\nselect pk_cliente, Cidade, [Cidade IBGE], [Cidade/UF], Código, [Nome-Código], CEP, UF,\n\tCONVERT(datetime, [Data de Criação], 103) as [Data de Criação],\n\t[Dias Criação], [Ano Criação], [Cidade SAP], Região, [Grupo Loja], Rede\nfrom dw.tmp_cliente\n\n\nPRINT @SEPARATOR + 'Drop tmp_cliente'\nDROP TABLE [dw].[tmp_cliente]\n\n\nDECLARE @COUNT_AFTER BIGINT\nSELECT @COUNT_AFTER = COUNT(*) FROM dw.cliente\nSELECT 'IMPORTAÇÃO REALIZADA', GETDATE() AS DT_FINALIZADO, @COUNT_AFTER AS COUNT_AFTER, MAX([pk_cliente]) AS MAX_PK_CLIENTE FROM dw.cliente\nPRINT @SEPARATOR + 'FIM: ' + CAST(@COUNT_AFTER AS VARCHAR(30)) + ' CLIENTES'\n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"poolName": "dwmwe",
				"databaseName": "dwmwe"
			}
		},
		"type": "SqlQuery"
	}
}