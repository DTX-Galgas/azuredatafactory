{
	"name": "Demo Cliente",
	"properties": {
		"content": {
			"query": "SET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\n\n\nDECLARE @SEPARATOR VARCHAR(30) = '     //     '\nDECLARE @COUNT_BEFORE BIGINT\nSELECT @COUNT_BEFORE = COUNT(*) FROM dw.cliente\nPRINT @SEPARATOR + 'INÍCIO: ' + CAST(@COUNT_BEFORE AS VARCHAR(30)) + ' CLIENTES'\n\n\nPRINT 'Create tmp_cliente'\nCREATE TABLE [dw].[tmp_cliente]\n( \n\t[pk_cliente] [bigint]  NULL,\n\t[Cidade] [nvarchar](3000)  NULL,\n\t[Cidade-IBGE] [nvarchar](3000)  NULL,\n\t[Cidade/UF] [nvarchar](3000)  NULL,\n\t[Código] [bigint]  NULL,\n\t[Nome-Código] [nvarchar](3000)  NULL,\n\t[CEP] [nvarchar](3000)  NULL,\n\t[UF] [nvarchar](3000)  NULL,\n\t[Data de Criação] [nvarchar](3000)  NULL,\n\t[Dias Criação] [bigint]  NULL,\n\t[Ano Criação] [bigint]  NULL,\n\t[Cidade SAP] [nvarchar](3000)  NULL,\n\t[Região] [nvarchar](3000)  NULL,\n\t[Grupo Loja] [nvarchar](3000)  NULL,\n\t[Rede] [nvarchar](3000)  NULL\n)\nWITH\n(\n\tDISTRIBUTION = ROUND_ROBIN,\n\tCLUSTERED COLUMNSTORE INDEX\n)\nGO\n\n\nPRINT @SEPARATOR + 'Copy csv to tmp_cliente'\nCOPY INTO dw.tmp_cliente\n\t(pk_cliente 1, Cidade 2, [Cidade-IBGE] 3, [Cidade/UF] 4, Código 5, [Nome-Código] 6, CEP 7, UF 8, [Data de Criação] 9, [Dias Criação] 10, [Ano Criação] 11, [Cidade SAP] 12, Região 13, [Grupo Loja] 14, Rede 15)\nFROM 'https://sadevbrdatalakemalwee.dfs.core.windows.net/raw/brazil/demo/Cliente.csv'\nWITH\n(\n\tFILE_TYPE = 'CSV'\n\t,MAXERRORS = 0\n\t,FIRSTROW = 2\n\t,ERRORFILE = 'https://sadevbrdatalakemalwee.dfs.core.windows.net/raw/brazil/demo/errors'\n\t,IDENTITY_INSERT = 'OFF'\n)\nGO\n\n\nPRINT @SEPARATOR + 'Drop cliente'\nDROP TABLE [dw].[cliente]\nGO\n\n\nPRINT @SEPARATOR + 'Create cliente'\nCREATE TABLE [dw].[cliente]\n( \n\t[pk_cliente] [bigint]  NOT NULL,\n\t[Cidade] [nvarchar](3000)  NULL,\n\t[Cidade-IBGE] [nvarchar](3000)  NULL,\n\t[Cidade/UF] [nvarchar](3000)  NULL,\n\t[Código] [bigint]  NOT NULL,\n\t[Nome-Código] [nvarchar](3000)  NULL,\n\t[CEP] [nvarchar](3000)  NULL,\n\t[UF] [nvarchar](3000)  NULL,\n\t[Data de Criação] [date]  NULL,\n\t[Dias Criação] [bigint]  NULL,\n\t[Ano Criação] [bigint]  NULL,\n\t[Cidade SAP] [nvarchar](3000)  NULL,\n\t[Região] [nvarchar](3000)  NULL,\n\t[Grupo Loja] [nvarchar](3000)  NULL,\n\t[Rede] [nvarchar](3000)  NULL\n)\nWITH\n(\n\tDISTRIBUTION = ROUND_ROBIN,\n\tCLUSTERED COLUMNSTORE INDEX\n)\nGO\n\n\nPRINT @SEPARATOR + 'Load tmp to cliente'\ninsert into dw.cliente\nselect pk_cliente, Cidade, [Cidade-IBGE], [Cidade/UF], Código, [Nome-Código], CEP, UF,\n\tCONVERT(datetime, [Data de Criação], 103) as [Data de Criação],\n\t[Dias Criação], [Ano Criação], [Cidade SAP], Região, [Grupo Loja], Rede\nfrom dw.tmp_cliente\n\n\nPRINT @SEPARATOR + 'Drop tmp_cliente'\nDROP TABLE [dw].[tmp_cliente]\nGO\n\n\nDECLARE @COUNT_FINAL BIGINT\nSELECT @COUNT_FINAL = COUNT(*) FROM dw.cliente\nSELECT 'IMPORTAÇÃO REALIZADA', GETDATE() AS DT_FINALIZADO, @COUNT_FINAL AS COUNT_FINAL, MAX([pk_cliente]) AS MAX_PK_CLIENTE FROM dw.cliente\nPRINT @SEPARATOR + 'FIM: ' + CAST(@COUNT_FINAL AS VARCHAR(30)) + ' CLIENTES'\nGO",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"poolName": "dwmwe",
				"databaseName": "dwmwe"
			}
		},
		"type": "SqlQuery"
	}
}