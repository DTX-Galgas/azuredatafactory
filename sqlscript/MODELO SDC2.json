{
	"name": "MODELO SDC2",
	"properties": {
		"content": {
			"query": "TRUNCATE TABLE  temp.clientes_processamento\nTRUNCATE TABLE  temp.clientes_final\n\ninsert into temp.clientes_processamento\nselect    \nconcat(ESTAB_IDCIGAM, CONVERT(INT,CLIENTE_CODIGO)) as PK_CLIENTE\n,[ESTAB_IDCIGAM]\n,[CLIENTE_CODIGO]\n,[CLIENTE_NOME]\n,[CLIENTE_CPFCNPJ]\n,[CLIENTE_EMAIL]\n,[CLIENTE_CIDADE]\n,[CLIENTE_ESTADO]\n,[CLIENTE_SEXO]\n,[CLIENTE_ANIVERSARIO]\n,[CLIENTE_DDD_CELULAR]\n,[CLIENTE_CELULAR]\n,[CLIENTE_ENDERECO]\n,[CLIENTE_NUMERO]\n,[CLIENTE_COMPLEMENTO]\n,[CLIENTE_BAIRRO]\n,[CLIENTE_CEP]\n,[NUM_MATRICULA]\n,[DAT_HORA_EXPORTACAO]\n,'SEM ALTERACAO' AS TIPO_ACAO\n,1 as FLAG_VICENGIA \n,getdate() as DAT_INICIO_VIGENCIA\n,null DAT_FINAL_VIGENCIA \nfrom [raw_data].[cigam_gst_bi_cliente]\n\ninsert into temp.clientes_final\nselect   \n PK_CLIENTE\n,[ESTAB_IDCIGAM]\n,[CLIENTE_CODIGO]\n,[CLIENTE_NOME]\n,[CLIENTE_CPFCNPJ]\n,[CLIENTE_EMAIL]\n,[CLIENTE_CIDADE]\n,[CLIENTE_ESTADO]\n,[CLIENTE_SEXO]\n,[CLIENTE_ANIVERSARIO]\n,[CLIENTE_DDD_CELULAR]\n,[CLIENTE_CELULAR]\n,[CLIENTE_ENDERECO]\n,[CLIENTE_NUMERO]\n,[CLIENTE_COMPLEMENTO]\n,[CLIENTE_BAIRRO]\n,[CLIENTE_CEP]\n,[NUM_MATRICULA]\n,[DAT_HORA_EXPORTACAO]\n,FLAG_VIGENCIA \n,DAT_INICIO_VIGENCIA\n,DAT_FINAL_VIGENCIA \nfrom temp.clientes_processamento\n\n\n\nMERGE  temp.clientes_processamento AS CLIENTE \nUSING(\n\t    select   \n         concat(ESTAB_IDCIGAM, CONVERT(INT,CLIENTE_CODIGO)) as PK_CLIENTE\n        ,[ESTAB_IDCIGAM]\n        ,[CLIENTE_CODIGO]\n        ,'N√ÉO INFORMADO' AS [CLIENTE_NOME]\n        ,[CLIENTE_CPFCNPJ]\n        ,[CLIENTE_EMAIL]\n        ,[CLIENTE_CIDADE]\n        ,[CLIENTE_ESTADO]\n        ,[CLIENTE_SEXO]\n        ,[CLIENTE_ANIVERSARIO]\n        ,[CLIENTE_DDD_CELULAR]\n        ,[CLIENTE_CELULAR]\n        ,[CLIENTE_ENDERECO]\n        ,[CLIENTE_NUMERO]\n        ,[CLIENTE_COMPLEMENTO]\n        ,[CLIENTE_BAIRRO]\n        ,[CLIENTE_CEP]\n        ,[NUM_MATRICULA]\n        ,[DAT_HORA_EXPORTACAO] \n        ,1 as FLAG_VIGENCIA \n        ,getdate() as DAT_INICIO_VIGENCIA\n        ,null DAT_FINAL_VIGENCIA \n        from [raw_data].[cigam_gst_bi_cliente]\n        where convert(date,DAT_HORA_EXPORTACAO) = '2021-02-22T00:00:00.0000000'\n        AND  concat(ESTAB_IDCIGAM, CONVERT(INT,CLIENTE_CODIGO))  IN(SELECT PK_CLIENTE FROM  TMP_PK)\n\n) AS DL ON (DL.PK_CLIENTE = CLIENTE.PK_CLIENTE)\n\tWHEN NOT MATCHED BY TARGET THEN INSERT (\n                                                    PK_CLIENTE\n                                                    ,ESTAB_IDCIGAM\n                                                    ,CLIENTE_CODIGO\n                                                    ,CLIENTE_NOME\n                                                    ,CLIENTE_CPFCNPJ\n                                                    ,CLIENTE_EMAIL\n                                                    ,CLIENTE_CIDADE\n                                                    ,CLIENTE_ESTADO\n                                                    ,CLIENTE_SEXO\n                                                    ,CLIENTE_ANIVERSARIO\n                                                    ,CLIENTE_DDD_CELULAR\n                                                    ,CLIENTE_CELULAR\n                                                    ,CLIENTE_ENDERECO\n                                                    ,CLIENTE_NUMERO\n                                                    ,CLIENTE_COMPLEMENTO\n                                                    ,CLIENTE_BAIRRO\n                                                    ,CLIENTE_CEP\n                                                    ,NUM_MATRICULA\n                                                    ,DAT_HORA_EXPORTACAO \n                                                    ,TIPO_ACAO\n                                                    ,FLAG_VIGENCIA\n                                                    ,DAT_INICIO_VIGENCIA\n                                                    ,DAT_FINAL_VIGENCIA\n                                               )\n\t\t\t\t\t\t\t\t\tVALUES (DL.PK_CLIENTE\n                                            ,DL.ESTAB_IDCIGAM\n                                            ,DL.CLIENTE_CODIGO\n                                            ,DL.CLIENTE_NOME\n                                            ,DL.CLIENTE_CPFCNPJ\n                                            ,DL.CLIENTE_EMAIL\n                                            ,DL.CLIENTE_CIDADE\n                                            ,DL.CLIENTE_ESTADO\n                                            ,DL.CLIENTE_SEXO\n                                            ,DL.CLIENTE_ANIVERSARIO\n                                            ,DL.CLIENTE_DDD_CELULAR\n                                            ,DL.CLIENTE_CELULAR\n                                            ,DL.CLIENTE_ENDERECO\n                                            ,DL.CLIENTE_NUMERO\n                                            ,DL.CLIENTE_COMPLEMENTO\n                                            ,DL.CLIENTE_BAIRRO\n                                            ,DL.CLIENTE_CEP\n                                            ,DL.NUM_MATRICULA\n                                            ,DL.DAT_HORA_EXPORTACAO \n                                            ,'INSERT'\n                                            ,DL.FLAG_VIGENCIA\n                                            ,DL.DAT_INICIO_VIGENCIA\n                                            ,DL.DAT_FINAL_VIGENCIA)\n    WHEN MATCHED AND (CLIENTE.CLIENTE_NOME != DL.CLIENTE_NOME)\n    THEN UPDATE SET \n    CLIENTE.CLIENTE_NOME = DL.CLIENTE_NOME, \n    TIPO_ACAO = 'UPDATE';\n\n\n\n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"poolName": "dwmwe",
				"databaseName": "dwmwe"
			}
		},
		"type": "SqlQuery"
	}
}