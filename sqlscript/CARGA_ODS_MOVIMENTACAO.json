{
	"name": "CARGA_ODS_MOVIMENTACAO",
	"properties": {
		"folder": {
			"name": "MODELO DIMENSIONAL"
		},
		"content": {
			"query": " ---VENDAS\n INSERT INTO ODS.PRE_CARGA_FATO_MOVIMENTO\n SELECT  \n CONVERT(INT,REPLACE(CONVERT(VARCHAR,CONVERT(DATE,DATA_CONFIRMACAO)),'-',''))                       AS DATA_CONFIRMACAO\n ,CONVERT(VARCHAR(5), LOJA.ESTAB_IDCIGAM)                                                           AS ESTAB_IDCIGAM\n ,CONVERT(INT, VENDAS.VENDEDOR_CODIGO )\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t AS VENDEDOR_CODIGO\n ,CONVERT(INT,CLIENTE.CLIENTE_CODIGO)                                                               AS CLIENTE_CODIGO\n ,CONVERT(VARCHAR(20), PRODUTO.PRODUTO_REFERENCIATAM )                                                 AS PRODUTO_REFERENCIATAM\n , UPPER(CONVERT(VARCHAR(50),ISNULL(VENDAS.MODALIDADE_VENDA,'NÃO INFORMADO')))                      AS MODALIDADE_VENDA\n ,CASE\n    WHEN VENDAS.TIPO_MOVIMENTO = 'V' THEN CONVERT(VARCHAR(15),'VENDA') \n    ELSE CONVERT(VARCHAR(15),'NÃO INFORMADO') \n END                                                                                                AS TIPO_MOVIMENTO \n ,CONVERT(INT,VENDAS.NUMERO_DOCTO)                                                                  AS NUMERO_DOCTO\n ,CONVERT(INT,VENDAS.QTD_ITEM)                                                                      AS VENDAS_QTD_ITEM\n ,CONVERT(NUMERIC(18,2),VENDAS.VALOR_UNITARIO)                                                      AS VENDAS_VALOR_UNITARIO\n ,CONVERT(NUMERIC(18,2),VENDAS.VALOR_TOTAL_ITEM)                                                    AS VENDAS_VALOR_TOTAL_ITEM\n ,0                                                                                                 AS DEVOLUCAO_QTD_ITEM\n ,0                                                                                                 AS DEVOLUCAO_VALOR_UNITARIO\n ,0                                                                                                 AS DEVOLUCAO_VALOR_TOTAL_ITEM\n FROM CLEANSING_DATA.GST_BI_VENDAS                                                                  AS VENDAS\n LEFT JOIN CLEANSING_DATA.GST_BI_ESTABELECIMENTO AS LOJA ON VENDAS.IDLOJA_CIGAM = LOJA.ESTAB_IDCIGAM\n LEFT JOIN CLEANSING_DATA.GST_BI_PRODUTOS AS PRODUTO ON VENDAS.CODIGO_BARRAS =  PRODUTO.PRODUTO_REFERENCIA \n LEFT JOIN CLEANSING_DATA.GST_BI_CLIENTES AS CLIENTE ON \n           VENDAS.IDLOJA_CIGAM = CLIENTE.ESTAB_IDCIGAM AND \n           VENDAS.CLIENTE_CODIGO = CLIENTE.CLIENTE_CODIGO\n\n--DEVOLUCAO\n INSERT INTO ODS.PRE_CARGA_FATO_MOVIMENTO\n SELECT \n CONVERT(INT,REPLACE(CONVERT(VARCHAR,CONVERT(DATE,DEVOLUCAO.DATA_CONFIRMACAO)),'-',''))             AS DATA_CONFIRMACAO\n ,CONVERT(VARCHAR(5), LOJA.ESTAB_IDCIGAM)                                                           AS ESTAB_IDCIGAM\n ,CONVERT(INT, DEVOLUCAO.VENDEDOR_CODIGO )                                                          AS VENDEDOR_CODIGO\n ,CONVERT(INT,CLIENTE.CLIENTE_CODIGO)                                                               AS CLIENTE_CODIGO\n ,CONVERT(VARCHAR(20), PRODUTO.PRODUTO_REFERENCIATAM )                                                 AS PRODUTO_REFERENCIATAM\n, CONVERT(VARCHAR(50),'NÃO INFORMADO')\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS MODALIDADE_VENDA\n ,CASE\n    WHEN DEVOLUCAO.TIPO_MOVIMENTO = 'D' THEN CONVERT(VARCHAR(15),'DEVOLUÇÃO') \n    ELSE CONVERT(VARCHAR(15),'NÃO INFORMADO') \n END                                                                                                AS TIPO_MOVIMENTO \n ,CONVERT(INT,DEVOLUCAO.NUMERO_DOCTO)                                                                  AS NUMERO_DOCTO\n ,0                                                                                                 AS VENDAS_QTD_ITEM\n ,0                                                                                                 AS VENDAS_VALOR_UNITARIO\n ,0                                                                                                 AS VENDAS_VALOR_TOTAL_ITEM\n ,CONVERT(INT,DEVOLUCAO.QTD_ITEM)                                                                   AS DEVOLUCAO_QTD_ITEM\n ,CONVERT(NUMERIC(18,2),DEVOLUCAO.VALOR_UNITARIO)                                                   AS DEVOLUCAO_VALOR_UNITARIO\n ,CONVERT(NUMERIC(18,2),DEVOLUCAO.VALOR_TOTAL_ITEM)                                                 AS DEVOLUCAO_VALOR_TOTAL_ITEM\n FROM CLEANSING_DATA.GST_BI_DEVOLUCAOCLIENTE                                                        AS DEVOLUCAO\n\n LEFT JOIN CLEANSING_DATA.GST_BI_ESTABELECIMENTO AS LOJA ON DEVOLUCAO.ESTAB_IDCIGAM = LOJA.ESTAB_IDCIGAM\n LEFT JOIN CLEANSING_DATA.GST_BI_PRODUTOS AS PRODUTO ON DEVOLUCAO.CODIGO_BARRAS =  PRODUTO.PRODUTO_REFERENCIA \n LEFT JOIN CLEANSING_DATA.GST_BI_CLIENTES AS CLIENTE ON \n           DEVOLUCAO.ESTAB_IDCIGAM = CLIENTE.ESTAB_IDCIGAM AND \n           DEVOLUCAO.CLIENTE_CODIGO = CLIENTE.CLIENTE_CODIGO\n\n\n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"poolName": "dwmwe",
				"databaseName": "dwmwe"
			}
		},
		"type": "SqlQuery"
	}
}