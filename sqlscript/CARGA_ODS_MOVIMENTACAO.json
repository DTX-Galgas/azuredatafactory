{
	"name": "CARGA_ODS_MOVIMENTACAO",
	"properties": {
		"folder": {
			"name": "MODELO DIMENSIONAL/cigam"
		},
		"content": {
			"query": "/*acrescentar o campos id_cupom_fiscal \nconcat(\n convert(int,replace(convert(varchar,convert(date,data_confirmacao)),'-','')) ,\n convert(int,vendas.numero_docto) ,\n convert(varchar(5), loja.estab_idcigam))\t\n*/\n\n\n truncate table  ods.pre_carga_fato_movimento\n ---vendas\n insert into ods.pre_carga_fato_movimento\n select  \n convert(int,replace(convert(varchar,convert(date,data_confirmacao)),'-',''))                       as data_confirmacao\n ,convert(varchar(5), loja.estab_idcigam)                                                           as estab_idcigam\n ,convert(int, vendas.vendedor_codigo )\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tas vendedor_codigo\n ,convert(int,cliente.cliente_codigo)                                                               as cliente_codigo\n ,convert(varchar(20), produto.produto_referenciatam )                                              as produto_referenciatam\n , upper(convert(varchar(50),isnull(vendas.modalidade_venda,'não informado')))                      as modalidade_venda\n ,case\n    when vendas.tipo_movimento = 'v' then convert(varchar(15),'venda') \n    else convert(varchar(15),'não informado') \n end                                                                                                as tipo_movimento \n ,convert(int,vendas.numero_docto)                                                                  as numero_docto\n ,convert(int,vendas.qtd_item)                                                                      as vendas_qtd_item\n ,convert(numeric(18,2),vendas.valor_unitario)                                                      as vendas_valor_unitario\n ,convert(numeric(18,2),vendas.valor_total_item)                                                    as vendas_valor_total_item\n ,convert(int,0)                                                                                    as devolucao_qtd_item\n ,convert(numeric(18,2),0)                                                                          as devolucao_valor_unitario\n ,convert(numeric(18,2),0)                                                                          as devolucao_valor_total_item\n from cleansing_data.cigam_gst_bi_vendas                                                                 as vendas\n inner join cleansing_data.cigam_gst_bi_estabelecimento as loja on vendas.idloja_cigam = loja.estab_idcigam\n left join cleansing_data.cigam_gst_bi_produtos as produto on vendas.codigo_barras =  produto.produto_referenciatam \n left join cleansing_data.cigam_gst_bi_clientes as cliente on \n           vendas.idloja_cigam = cliente.estab_idcigam and \n           vendas.cliente_codigo = cliente.cliente_codigo\n\n\n\n\n--devolucao\n insert into ods.pre_carga_fato_movimento\n select \n convert(int,replace(convert(varchar,convert(date,devolucao.data_confirmacao)),'-',''))             as data_confirmacao\n ,convert(varchar(5), loja.estab_idcigam)                                                           as estab_idcigam\n ,convert(int, devolucao.vendedor_codigo )                                                          as vendedor_codigo\n ,convert(int,cliente.cliente_codigo)                                                               as cliente_codigo\n ,convert(varchar(20), produto.produto_referenciatam )                                                 as produto_referenciatam\n, convert(varchar(50),'não informado')\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tas modalidade_venda\n ,case\n    when devolucao.tipo_movimento = 'd' then convert(varchar(15),'devolução') \n    else convert(varchar(15),'não informado') \n end                                                                                                as tipo_movimento \n ,convert(int,devolucao.numero_docto)                                                               as numero_docto\n ,convert(int,0)                                                                                    as vendas_qtd_item\n ,convert(numeric(18,2),0)                                                                          as vendas_valor_unitario\n ,convert(numeric(18,2),0)                                                                          as vendas_valor_total_item\n ,convert(int,devolucao.qtd_item)                                                                   as devolucao_qtd_item\n ,convert(numeric(18,2),devolucao.valor_unitario)                                                   as devolucao_valor_unitario\n ,convert(numeric(18,2),devolucao.valor_total_item)                                                 as devolucao_valor_total_item\n from cleansing_data.cigam_gst_bi_devolucaocliente  \t\t\t\t\t\t\t\t\t\t\t    as devolucao          \n inner join cleansing_data.cigam_gst_bi_estabelecimento as loja on devolucao.estab_idcigam = loja.estab_idcigam\n left join cleansing_data.cigam_gst_bi_produtos as produto on devolucao.codigo_barras =  produto.produto_referenciatam \n left join cleansing_data.cigam_gst_bi_clientes as cliente on \n           devolucao.estab_idcigam = cliente.estab_idcigam and \n           devolucao.cliente_codigo = cliente.cliente_codigo\t ",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"poolName": "dwmwe",
				"databaseName": "dwmwe"
			}
		},
		"type": "SqlQuery"
	}
}