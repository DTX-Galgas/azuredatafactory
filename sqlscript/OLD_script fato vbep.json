{
	"name": "script fato vbep",
	"properties": {
		"folder": {
			"name": "MODELO DIMENSIONAL/sap"
		},
		"content": {
			"query": "---VBAK, -> VBAP -> VBEP\nselect \nvbap.VBELN\t\n,vbap.POSNR\t\n,vbap.MATNR\t\n,vbap.PSTYV\t\n,vbap.UMZIZ\t\n,vbap.UMZIN\t\n,vbap.KWMENG\t\n,vbap.VRKME\t\n,vbap.WERKS\t\n,vbap.J_3ASEAN\t\n,vbak.VBELN\t\n,vbak.ERDAT\t\n,vbak.ERNAM\t\n,vbak.AUDAT\t\n,vbak.VBTYP\t\n,vbak.AUART\t\n,vbak.FAKSK\t\n,vbak.VKORG\t\n,vbak.VTWEG\t\n,vbak.SPART\t\n,vbak.VKGRP\t\n,vbak.VKBUR\t\n,vbak.KNUMV\t\n,vbak.VDATU\t\n,vbak.BSARK\t\n,vbak.KUNNR\t\n,vbak.AEDAT\t\n,vbak.KVGR3\t\n,vbak.BUKRS_VF\n,vbep.VBELN\t\n,vbep.POSNR\t\n,vbep.ETENR\t\n,vbep.WMENG\t\n,vbep.J_3ASIZE\t\n,vbep.J_3ASZGR\t\n,sum(vbep.J_3ANETW) as J_3ANETW\n,sum(vbap.NETWR) as NETWR\t\n,sum(convert(numeric(18,2),konv_k.KWERT)) as KWERT_k\n,sum(convert(numeric(18,2),konv_b.KWERT)) as KWERT_b\n--,vbap.NETWR\nfrom cleansing_data.sap_vbap as vbap   \nleft join cleansing_data.sap_vbak as vbak on vbap.VBELN = vbak.VBELN\n--left join cleansing_data.sap_tvagt  as tvagt on tvagt. = vbap.VRKME\n--cleansing_data.sap_t006a\nleft join cleansing_data.sap_vbep as vbep on \n\t\tvbep.VBELN  = vbap.VBELN  and \n\t\tvbep.POSNR  = vbap.POSNR \n\n\nleft join cleansing_data.sap_konv  as konv_k  on  konv_k.KNUMV = vbak.KNUMV \nleft join cleansing_data.sap_konv  as konv_b  on  konv_b.KPOSN = vbep.POSNR and konv_b.KSTAT <> 'X' \nand konv_b.KSCHL in('ZCMI','ICMI','ZNFC')\nwhere vbap.VBELN = '0001413005' --and vbap.MATNR\t= '000000001000059056'\ngroup by \nvbap.VBELN\t\n,vbap.POSNR\t\n,vbap.MATNR\t\n,vbap.PSTYV\t\n,vbap.UMZIZ\t\n,vbap.UMZIN\t\n,vbap.KWMENG\t\n,vbap.VRKME\t\n,vbap.WERKS\t\n,vbap.J_3ASEAN\t\n,vbak.VBELN\t\n,vbak.ERDAT\t\n,vbak.ERNAM\t\n,vbak.AUDAT\t\n,vbak.VBTYP\t\n,vbak.AUART\t\n,vbak.FAKSK\t\n,vbak.VKORG\t\n,vbak.VTWEG\t\n,vbak.SPART\t\n,vbak.VKGRP\t\n,vbak.VKBUR\t\n,vbak.KNUMV\t\n,vbak.VDATU\t\n,vbak.BSARK\t\n,vbak.KUNNR\t\n,vbak.AEDAT\t\n,vbak.KVGR3\t\n,vbak.BUKRS_VF\n,vbep.VBELN\t\n,vbep.POSNR\t\n,vbep.ETENR\t\n,vbep.WMENG\t\n,vbep.J_3ASIZE\t\n,vbep.J_3ASZGR\t\n\n /***** cte ****/\n ;with vbap_vbep_cte as\n(\nselect \nconcat(vbak.KNUMV,vbep.POSNR) as pk_vbap_vbep\n,vbap.VBELN\tas vbap_VBELN\n,vbap.POSNR\tas vbap_POSNR\n,vbap.MATNR\t\n,vbap.PSTYV\t\n,vbap.UMZIZ\t\n,vbap.UMZIN\t\n,vbap.KWMENG\t\n,vbap.VRKME\t\n,vbap.WERKS\t\n,vbap.J_3ASEAN\t\n,vbak.VBELN\t as vbak_VBELN\n,vbak.ERDAT\t\n,vbak.ERNAM\t\n,vbak.AUDAT\t\n,vbak.VBTYP\t\n,vbak.AUART\t\n,vbak.FAKSK\t\n,vbak.VKORG\t\n,vbak.VTWEG\t\n,vbak.SPART\t\n,vbak.VKGRP\t\n,vbak.VKBUR\t\n,vbak.KNUMV\t\n,vbak.VDATU\t\n,vbak.BSARK\t\n,vbak.KUNNR\t\n,vbak.AEDAT\t\n,vbak.KVGR3\t\n,vbak.BUKRS_VF\n,vbep.VBELN\t\n,vbep.POSNR\t as vbep_POSNR\n,vbep.ETENR\t\n,vbep.WMENG\t\n,vbep.J_3ASIZE\t\n,vbep.J_3ASZGR\t\n,vbep.J_3ANETW\n,vbap.NETWR\n--,vbap.NETWR\nfrom cleansing_data.sap_vbap as vbap   \nleft join cleansing_data.sap_vbak as vbak on vbap.VBELN = vbak.VBELN\n--left join cleansing_data.sap_tvagt  as tvagt on tvagt. = vbap.VRKME\n--cleansing_data.sap_t006a\nleft join cleansing_data.sap_vbep as vbep on \n\t\tvbep.VBELN  = vbap.VBELN  and \n\t\tvbep.POSNR  = vbap.POSNR \nwhere vbap.VBELN = '0001413005' and vbap.MATNR\t= '000000001000059056'\n) \n,konv_cte \nas\n(\n\tselect \n\tconcat(KNUMV,KPOSN) as pk_konv_cte\n\t,KNUMV\t\n\t,KPOSN\t\n\t,STUNR\t\n\t,ZAEHK\t\n\t,KSCHL\t\n\t,KWERT\t\n\t,KAWRT\t\n\t,KBETR\t\n\t,KSTAT\t\n\t,KDATU\t\n\t,KINAK\t\n\t,VBELN from cleansing_data.sap_konv\n\twhere KSTAT <> 'X' and KSCHL in('ZCMI','ICMI','ZNFC')\n)\n\nselect vbap_vbep_cte.*, konv_cte.*\nfrom vbap_vbep_cte left join konv_cte on \n\nvbap_vbep_cte.pk_vbap_vbep = konv_cte.pk_konv_cte\n\n'0006049695000900'\n\nselect KNUMV from cleansing_data.sap_konv\nwhere KNUMV = '0006049695'\n\t\t\t   \n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"poolName": "Built-in",
				"databaseName": "master"
			}
		},
		"type": "SqlQuery"
	}
}